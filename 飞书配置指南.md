# 飞书多维表格Webhook配置指南

## 1. 启动服务

```bash
./start.sh
```

选择选项1 - localtunnel，获得公网地址，如：`https://abc123.loca.lt`

## 2. 飞书多维表格配置

### 创建机器人
1. 进入飞书多维表格
2. 点击"自动化" → "机器人"
3. 创建新机器人 → "Webhook机器人"

### 配置Webhook
- **URL地址**: `https://你的域名.loca.lt/hook`
- **请求方法**: POST  
- **内容类型**: application/json

### 触发条件
- **触发时机**: 记录创建时 / 记录更新时
- **触发范围**: 指定数据表

### 请求体配置
选择要发送的字段：
- 姓名 (name)
- 职位 (title) 
- 公司 (company)
- 电话 (phone)
- 邮箱 (email)
- 头像链接 (avatar_url)
- 二维码链接 (qrcode_url)
- 二维码文本 (qrcode_text)

## 3. 测试验证

### 手动测试
```bash
curl -X POST https://你的域名.loca.lt/hook \
  -H "Content-Type: application/json" \
  -d '{
    "name": "张三",
    "title": "产品经理",
    "company": "科技公司",
    "phone": "13800138000",
    "email": "zhangsan@example.com"
  }'
```

### 响应处理
机器人会返回：
- `status`: 处理状态
- `saved_path`: 本地保存路径  
- `image_key`: 飞书图片ID（需配置正确的APP_ID/SECRET）
- `send_result`: 发送结果

## 4. 获取PNG图片

在webhook URL后添加 `?format=png` 直接获取图片：
```
https://你的域名.loca.lt/hook?format=png
```

## 5. 故障排除

- **端口占用**: 运行脚本会自动处理
- **依赖缺失**: 脚本会自动安装
- **权限问题**: 确保start.sh有执行权限 `chmod +x start.sh`
- **网络问题**: localtunnel偶尔不稳定，重启即可